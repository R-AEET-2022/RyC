---
title: "Pasion_de_Herrerillos"
author: "RRM & CGC"
date: "2022-09-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE, eval=TRUE}
library("tidyverse")
library("here")
```

# Data management

Import blue tit data

```{r}
data<-read_csv(here('blue_tit_data.csv'))
```

Haremos una selección de los pollos cuyos nidos no han sido manipulados, además retiraremos los casos donde no se conoce la paternidad de los pollos.

```{r}
data1<-data%>%
  #filter(rear_nest_trt==7)%>%
  filter(`Extra-pair_paternity`!= '.')

```

Nos quedaremos con las variables que nos interesan para el análisis, las renombraremos y recodificaremos las variables categóricas porque me da la gana::

```{r}
b_tit<- data1 %>% 
  select(chick_ID = chick_ring_number,
                          year = hatch_year,
         paternity = `Extra-pair_paternity`,
         hatch_size = d0_hatch_nest_brood_size,
         n_fledgings = number_chicks_fledged_from_rear_nest,
         date_14 = Date_of_day14,
         tarsus = day_14_tarsus_length,
         weight = day_14_weight,
         sex = chick_sex_molec,
         survival = chick_survival_to_first_breed_season)%>%
  mutate (sex= recode(sex,
                      "1" = "M",
                      "2" = "F"))%>%
  mutate (paternity= recode(paternity,
                      "1" = "Amante",
                      "2" = "Marido"))
```

Calcularemos la variable condición corporal a partir de las medidas del tarso y del peso de los pollos

```{r}
b_tit %>%
  select(date_14,tarsus,weight,survival)%>%
  pairs()

```

```{r}
ggplot(b_tit, aes(x = log(tarsus), y= log(weight)))+
  geom_smooth(method = 'lm')+
  geom_point(aes(color=as.factor(paternity)),
             alpha = 0.4)

```

```{r}
m1 <- glm(survival ~ paternity, family = 'binomial', data = b_tit)
summary(m1)

library(DHARMa)
simulateResiduals(m1, plot = TRUE)

library('performance')
check_model(m1)
```

```{r}
body_cond<- lm(weight ~ tarsus, data = b_tit)
summary(body_cond)
```

```{r}


m2<-glm(residual)
```
